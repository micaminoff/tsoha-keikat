{% extends "layout.html" %}
{% from 'field_macro.html' import render_field %}

{% block body %}
<section class="section">
    <form method="POST" action="{{ url_for('events_create') }}">

        <!--
            render_field() is a macro to enforce DRY between event modification and creation
            reference: https://flask.palletsprojects.com/en/1.1.x/patterns/wtforms/
        -->

        {{render_field(form.name)}}

        <div class='field'>
            <div id='subforms-container'>
                {% for performer in form.performers %}
                <div id="performer-{{ loop.index0 }}-form" class="subform" data-index="{{ loop.index0 }}">
                    {{ performer(class_='select') }}
                    <a class='button is-danger remove' href="#">Remove</a>
                </div>
                {% endfor %}
            </div>
        </div>
        <a class='button is-info' id='add' href="#">Add another</a>

        {% if form.performers.errors %}
        <ul class='errors'>
            {% for error in form.performers.errors %}
            <li><span class='is-danger tag'>{{error}}</span></li>
            {% endfor %}
        </ul>
        {% endif %}
        {{render_field(form.venue)}}

        {{render_field(form.date, type='date')}}

        <div class="field">
            <input class="button is-info" type="submit" value="Add a new Event" />
        </div>
    </form>
</section>
{# Template form for dynamic number of performers #}
{# Thanks to Rafael Medina (https://www.rmedgar.com/blog/dynamic-fields-flask-wtf) #}
<div id="performer-_-form" class="is-hidden" data-index="_">
    <table class="select" id="performers-_">
        <tbody>
            <tr>
                <th><label for="performers-_-performer">Performer</label></th>
                <td><select id="performers-_-performer" name="performers-_-performer">
                        <option value="1">test</option>
                        <option value="2">test2</option>
                        <option value="3">hdfjsbdfjpsdhfhpsuiojdfbhpisujdbfpisjdfbpsdijfbspdf</option>
                        <option value="4">asdsadasddas</option>
                        <option value="5">test</option>
                    </select></td>
            </tr>
        </tbody>
    </table>
    <a class="button is-danger remove" href="#">Remove</a>
</div>
{% endblock %}